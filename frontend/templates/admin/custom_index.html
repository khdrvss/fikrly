{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Boshqaruv paneli - Fikrly Admin{% endblock %}

{% block extrastyle %}
<style>
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.stat-card {
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    border-left: 4px solid #417690;
}

.stat-card h3 {
    margin: 0 0 10px 0;
    font-size: 14px;
    color: #666;
    text-transform: uppercase;
}

.stat-card .value {
    font-size: 32px;
    font-weight: bold;
    color: #333;
}

.stat-card .subtext {
    font-size: 12px;
    color: #999;
    margin-top: 5px;
}

.stat-card.warning {
    border-left-color: #f0ad4e;
}

.stat-card.success {
    border-left-color: #5cb85c;
}

.stat-card.danger {
    border-left-color: #d9534f;
}

.stat-card.info {
    border-left-color: #5bc0de;
}

.section {
    background: white;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.section h2 {
    margin: 0 0 15px 0;
    padding-bottom: 10px;
    border-bottom: 2px solid #eee;
    font-size: 18px;
}

table.activity-table {
    width: 100%;
    border-collapse: collapse;
}

table.activity-table th {
    background: #f5f5f5;
    padding: 10px;
    text-align: left;
    font-size: 12px;
    text-transform: uppercase;
    color: #666;
}

table.activity-table td {
    padding: 10px;
    border-bottom: 1px solid #eee;
    font-size: 13px;
}

table.activity-table tr:hover {
    background: #f9f9f9;
}

.badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: bold;
}

.badge.success { background: #5cb85c; color: white; }
.badge.warning { background: #f0ad4e; color: white; }
.badge.danger { background: #d9534f; color: white; }
.badge.info { background: #5bc0de; color: white; }

.quick-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.quick-actions a {
    display: inline-block;
    padding: 10px 20px;
    background: #417690;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    font-size: 13px;
}

.quick-actions a:hover {
    background: #205067;
}
</style>
{% endblock %}

{% block content %}
<h1>üìä Boshqaruv paneli</h1>

<!-- Statistics Cards -->
<div class="dashboard-grid">
    <div class="stat-card info">
        <h3>Jami foydalanuvchilar</h3>
        <div class="value">{{ total_users }}</div>
        <div class="subtext">{{ active_users_7d }} aktiv (7 kun)</div>
    </div>
    
    <div class="stat-card success">
        <h3>Jami bizneslar</h3>
        <div class="value">{{ total_companies }}</div>
        <div class="subtext">{{ verified_companies }} tasdiqlangan</div>
    </div>
    
    <div class="stat-card">
        <h3>Jami sharhlar</h3>
        <div class="value">{{ total_reviews }}</div>
        <div class="subtext">{{ approved_reviews }} tasdiqlangan</div>
    </div>
    
    <div class="stat-card warning">
        <h3>Kutilmoqda</h3>
        <div class="value">{{ pending_reviews }}</div>
        <div class="subtext">{{ pending_verifications }} biznes tasdiqlamasi</div>
    </div>
</div>

<!-- Quick Actions -->
<div class="section">
    <h2>‚ö° Tezkor amallar</h2>
    <div class="quick-actions">
        <a href="{% url 'admin:frontend_review_changelist' %}?is_approved__exact=0">Sharhlarni tasdiqlash ({{ pending_reviews }})</a>
        <a href="{% url 'admin:frontend_company_changelist' %}?is_verified__exact=0">Biznes tasdiqlamalari ({{ pending_verifications }})</a>
        <a href="{% url 'admin:frontend_reviewreport_changelist' %}?status__exact=pending">Reportlar ({{ pending_reports }})</a>
        <a href="{% url 'admin:frontend_companyclaim_changelist' %}?status__exact=pending">Claimlar ({{ pending_claims }})</a>
        <a href="{% url 'admin:frontend_user_changelist' %}">Foydalanuvchilar</a>
    </div>
</div>

<!-- Top Companies -->
<div class="section">
    <h2>‚≠ê Eng yaxshi bizneslar</h2>
    <table class="activity-table">
        <thead>
            <tr>
                <th>Biznes</th>
                <th>Kategoriya</th>
                <th>Reyting</th>
                <th>Sharhlar</th>
                <th>Holat</th>
            </tr>
        </thead>
        <tbody>
            {% for company in top_companies %}
            <tr>
                <td>
                    <a href="{% url 'admin:frontend_company_change' company.id %}">{{ company.name }}</a>
                </td>
                <td>{{ company.category_fk.name|default:"-" }}</td>
                <td>
                    <strong>{{ company.rating|floatformat:1 }}</strong> ‚≠ê
                </td>
                <td>{{ company.review_count }}</td>
                <td>
                    {% if company.is_verified %}
                        <span class="badge success">‚úì Tasdiqlangan</span>
                    {% else %}
                        <span class="badge">Oddiy</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" style="text-align: center; color: #999;">Ma'lumot yo'q</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Recent Activity -->
<div class="section">
    <h2>üìù So'nggi faoliyat</h2>
    <table class="activity-table">
        <thead>
            <tr>
                <th>Vaqt</th>
                <th>Amal</th>
                <th>Foydalanuvchi</th>
                <th>Tafsilotlar</th>
            </tr>
        </thead>
        <tbody>
            {% for activity in recent_activity %}
            <tr>
                <td>{{ activity.created_at|date:"Y-m-d H:i" }}</td>
                <td>{{ activity.get_action_display }}</td>
                <td>
                    {% if activity.actor %}
                        <a href="{% url 'admin:frontend_user_change' activity.actor.id %}">
                            {{ activity.actor.username }}
                        </a>
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {% if activity.company %}
                        <a href="{% url 'admin:frontend_company_change' activity.company.id %}">
                            {{ activity.company.name }}
                        </a>
                    {% elif activity.review %}
                        <a href="{% url 'admin:frontend_review_change' activity.review.id %}">
                            Sharh #{{ activity.review.id }}
                        </a>
                    {% else %}
                        {{ activity.details|default:"-" }}
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" style="text-align: center; color: #999;">Hech qanday faoliyat yo'q</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Recent Reviews -->
<div class="section">
    <h2>üí¨ So'nggi sharhlar</h2>
    <table class="activity-table">
        <thead>
            <tr>
                <th>Vaqt</th>
                <th>Biznes</th>
                <th>Foydalanuvchi</th>
                <th>Reyting</th>
                <th>Holat</th>
            </tr>
        </thead>
        <tbody>
            {% for review in recent_reviews %}
            <tr>
                <td>{{ review.created_at|date:"Y-m-d H:i" }}</td>
                <td>
                    <a href="{% url 'admin:frontend_company_change' review.company.id %}">
                        {{ review.company.name }}
                    </a>
                </td>
                <td>{{ review.user_name|default:review.author.username }}</td>
                <td>
                    {{ review.rating }} ‚≠ê
                </td>
                <td>
                    {% if review.is_approved %}
                        <span class="badge success">Tasdiqlangan</span>
                    {% else %}
                        <span class="badge warning">Kutilmoqda</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- System Info -->
<div class="section">
    <h2>‚ÑπÔ∏è Tizim ma'lumotlari</h2>
    <ul>
        <li><strong>O'rtacha reyting:</strong> {{ avg_rating }} / 5.0</li>
        <li><strong>Tasdiqlangan xaridli sharhlar:</strong> {{ verified_purchase_reviews }}</li>
        <li><strong>Yangi foydalanuvchilar (30 kun):</strong> {{ new_users_30d }}</li>
        <li><strong>Email tasdiqlangan foydalanuvchilar:</strong> {{ verified_users }}</li>
        <li><strong>Faol bizneslar:</strong> {{ active_companies }} / {{ total_companies }}</li>
    </ul>
</div>

{% endblock %}
