{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}Fikrly.uz — O‘zbekiston sharhlar platformasi{% endblock %}

{% block meta_description %}Fikrly.uz — O‘zbekistondagi kompaniyalar haqida haqiqiy foydalanuvchi sharhlari va reytinglari. Qaysi biri yaxshi? Fikrlar orqali bilib oling.{% endblock %}

{% block extra_head %}
{{ block.super }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Website",
  "name": "Fikrly.uz",
  "alternateName": "Fikrly",
  "url": "https://fikrly.uz/",
  "description": "Fikrly.uz — O‘zbekiston bizneslari uchun sharhlar va reytinglar platformasi."
}
</script>
{% endblock %}

{% block meta_keywords %}
<meta name="keywords" content="fikrly, fikrly.uz, fikrly uz, sharhlar, reytinglar, kompaniya sharhlari, xizmatlar sharhlari, biznes sharhlari, toshkent sharhlar, toshkent reytinglar, toshkent kompaniyalari, mijoz fikrlari toshkent, toshkentdagi eng yaxshi xizmatlar, toshkentdagi ishonchli kompaniyalar, xizmat sifati toshkent, toshkent restoran sharhlari, toshkent kafe sharhlari, toshkent klinika sharhlari, toshkent dorixona sharhlari, toshkent shifokor sharhlari, toshkent avtoservis sharhlari, toshkent qurilish kompaniyalari sharhlari, toshkent developer sharhlari, toshkent internet provider sharhlari, toshkent bank sharhlari, toshkent ta'lim markazi sharhlari, toshkent salon sharhlari, toshkent xizmatlarini solishtirish, toshkentda ishonchli biznes topish, toshkent yomon xizmat sharhlari, toshkent yaxshi xizmat sharhlari" />
{% endblock %}

{% block content %}
    <!-- Hero Section -->
    <section class="relative bg-[var(--surface)] overflow-hidden">
        <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-14 sm:py-20 md:py-32 text-center">
            <h1 class="text-3xl sm:text-4xl md:text-6xl font-bold text-[var(--text-primary)] mb-4 sm:mb-6 tracking-tight">
                {% trans "Haqiqiy fikrlar," %} <br />
                <span class="text-[var(--accent)]">{% trans "ishonchli tanlov" %}</span>
            </h1>
            <p class="text-xl text-[var(--text-secondary)] mb-10 max-w-2xl mx-auto leading-relaxed">
                {% if LANGUAGE_CODE == 'ru' %}
                Самая надежная платформа отзывов в Узбекистане. Находите лучшие компании по реальным отзывам клиентов.
                {% else %}
                {% trans "O'zbekistonning eng ishonchli sharh platformasi. Haqiqiy mijozlar fikrlari orqali eng yaxshi bizneslarni toping." %}
                {% endif %}
            </p>

            <!-- Search Bar -->
            <div class="max-w-3xl mx-auto relative z-10">
                <form method="get" action="{% url 'search_businesses' %}" class="relative group" id="searchForm">
                    <div class="absolute inset-y-0 left-0 pl-5 flex items-center pointer-events-none">
                        <svg class="h-6 w-6 text-gray-400 group-focus-within:text-primary-500 transition-colors" aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </div>
                    <input type="text" 
                           name="q" 
                           id="searchInput" 
                           aria-label="{% trans 'Bizneslarni qidirish' %}" 
                           placeholder="{% trans 'Biznes nomi, kategoriya yoki joylashuvni qidiring...' %}" 
                           class="block w-full pl-14 pr-32 py-3 md:py-4 text-base md:text-lg bg-[var(--surface)] text-[var(--text-primary)] border-0 rounded-2xl shadow-lg ring-1 ring-[var(--border)] focus:ring-2 focus:ring-[var(--accent)] placeholder-[var(--text-secondary)] transition-shadow" 
                           autocomplete="off" />

                    <!-- Search Suggestions Dropdown -->
                    <div id="searchSuggestions" class="absolute top-full left-0 right-0 mt-2 bg-[var(--surface)] rounded-xl shadow-xl border border-[var(--border)] overflow-hidden z-50 hidden">
                        <!-- Content will be injected via JS -->
                    </div>

                    <div class="absolute inset-y-2 right-2">
                        <button type="submit" id="searchBtn" class="h-full bg-[var(--accent)] hover:opacity-90 text-white font-medium px-4 md:px-8 rounded-xl transition-colors flex items-center">
                            <span id="searchBtnText">{% trans "Qidirish" %}</span>
                            <svg id="searchBtnSpinner" class="hidden w-4 h-4 animate-spin ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                            </svg>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Popular Categories Tags -->
            <div class="mt-8 flex flex-wrap justify-center gap-3 text-sm text-[var(--text-secondary)]">
                <span>{% trans "Mashhur:" %}</span>
                {% for cat in featured_categories %}
                <a href="{% url 'business_list' %}?category={{ cat.slug }}" class="hover:text-[var(--accent)] underline decoration-dotted">{{ cat.display_name }}</a>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- Category Navigation -->
    <section class="py-10 sm:py-16 bg-[var(--bg)]">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-[var(--text-primary)] mb-4">{% trans "Kategoriyalarni ko'rish" %}</h2>
                <p class="text-[var(--text-secondary)] max-w-2xl mx-auto">{% trans "O'zingizga kerakli xizmat turini tanlang va eng yaxshi takliflarni toping" %}</p>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                {% for cat in featured_categories %}
                <a href="{% url 'business_list' %}?category={{ cat.slug }}" class="bg-[var(--surface)] p-4 md:p-6 rounded-2xl shadow-sm hover:shadow-md transition-all border border-[var(--border)] group text-center">
                    <div class="w-14 h-14 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform
                        {% if cat.color == 'red' %}bg-red-50 text-red-600 group-hover:bg-red-100
                        {% elif cat.color == 'orange' %}bg-orange-50 text-orange-600 group-hover:bg-orange-100
                        {% elif cat.color == 'yellow' %}bg-yellow-50 text-yellow-600 group-hover:bg-yellow-100
                        {% elif cat.color == 'green' %}bg-green-50 text-green-600 group-hover:bg-green-100
                        {% elif cat.color == 'blue' %}bg-primary-50 text-primary-600 group-hover:bg-primary-100
                        {% elif cat.color == 'purple' %}bg-purple-50 text-purple-600 group-hover:bg-purple-100
                        {% elif cat.color == 'pink' %}bg-pink-50 text-pink-600 group-hover:bg-pink-100
                        {% else %}bg-gray-50 text-gray-600 group-hover:bg-gray-100{% endif %}">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            {{ cat.icon_svg|safe }}
                        </svg>
                    </div>
                    <h3 class="font-semibold text-[var(--text-primary)] group-hover:text-[var(--accent)] transition-colors">{{ cat.display_name }}</h3>
                    <p class="text-sm text-[var(--text-secondary)] mt-1">{% blocktrans with count=cat.company_count %}{{ count }} ta biznes{% endblocktrans %}</p>
                </a>
                {% endfor %}
            </div>

            <div class="text-center mt-10">
                <a href="{% url 'category_browse' %}" class="inline-flex items-center text-[var(--accent)] font-semibold hover:opacity-80 transition-colors">
                    {% trans "Barcha kategoriyalarni ko'rish" %}
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>
                </a>
            </div>
        </div>
    </section>

    <!-- Trending Businesses -->
    <section class="py-10 sm:py-16 bg-[var(--surface)]">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-end mb-12">
                <div>
                    <h2 class="text-3xl font-bold text-[var(--text-primary)] mb-2">{% trans "Mashhur bizneslar" %}</h2>
                    <p class="text-[var(--text-secondary)]">{% trans "Foydalanuvchilar tomonidan eng ko'p ko'rilgan" %}</p>
                </div>
                <a href="{% url 'category_browse' %}" class="hidden md:inline-flex items-center text-[var(--accent)] hover:opacity-80 font-semibold transition-colors">
                    {% trans "Barchasini ko'rish" %}
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>
                </a>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                {% for company in trending_companies %}
                <a href="{% url 'company_detail' company.pk %}" class="block bg-[var(--surface)] rounded-2xl shadow-sm border border-[var(--border)] overflow-hidden hover:shadow-md transition-all group">
                    <div class="relative h-48 overflow-hidden bg-gray-100">
                            <img src="{{ company.display_image_url|default:company.image_url|default:'https://images.unsplash.com/photo-1542744173-8e7e53415bb0?q=80&w=1200&auto=format&fit=crop' }}"
                                alt="{{ company.name }}"
                                {% if forloop.counter <= 3 %}
                                loading="eager"
                                fetchpriority="high"
                                {% else %}
                                loading="lazy"
                                {% endif %}
                                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                                onerror="this.onerror=null;this.src='https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=1200&auto=format&fit=crop';" />
                        <div class="absolute top-4 right-4 bg-[var(--surface)]/90 backdrop-blur-sm px-2 py-1 rounded-lg text-xs font-bold text-[var(--text-primary)] shadow-sm">
                            {{ company.category_fk.display_name }}
                        </div>
                        <div class="absolute bottom-4 left-4 w-14 h-14 flex-shrink-0 bg-[#F8FAFC] rounded-2xl border border-[#E5E7EB] shadow-md overflow-hidden flex items-center justify-center">
                                {% if company.display_logo %}
                                <img src="{{ company.display_logo }}"
                                     alt="{{ company.name }} logo"
                                     class="w-full h-full object-contain p-2.5"
                                     style="transform: scale(calc({{ company.logo_scale|default:100 }} / 100));"
                                     onerror="this.onerror=null;this.src='https://api.dicebear.com/7.x/shapes/svg?seed={{ company.name|urlencode }}&backgroundColor=b6e3f4,c0aede,d1d4f9&backgroundType=gradientLinear';">
                                {% else %}
                                <img src="https://api.dicebear.com/7.x/shapes/svg?seed={{ company.name|urlencode }}&backgroundColor=b6e3f4,c0aede,d1d4f9&backgroundType=gradientLinear"
                                     alt="Logo" class="w-full h-full object-contain p-2.5">
                                {% endif %}
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="flex items-start justify-between mb-3">
                            <h3 class="text-xl font-bold text-[var(--text-primary)] group-hover:text-[var(--accent)] transition-colors flex items-center gap-1">
                                {{ company.name }}
                                {% if company.is_verified %}
                                    <svg class="w-5 h-5 text-green-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                    </svg>
                                {% endif %}
                            </h3>
                            <div class="flex items-center bg-green-50 px-2 py-1 rounded-lg">
                                <svg class="w-4 h-4 text-green-500 mr-1" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                                <span class="font-bold text-green-700 text-sm">{{ company.rating }}</span>
                            </div>
                        </div>
                        <div class="flex items-center text-[var(--text-secondary)] text-sm mb-4">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                            {{ company.city }}
                        </div>
                        <div class="flex items-center justify-between pt-4 border-t border-[var(--border)]">
                            <span class="text-sm text-[var(--text-secondary)]">{% blocktrans with count=company.review_count %}{{ count }} ta sharh{% endblocktrans %}</span>
                            <span class="text-[var(--accent)] font-medium text-sm hover:opacity-80 transition-colors">{% trans "Batafsil" %} →</span>
                        </div>
                    </div>
                </a>
                {% empty %}
                <div class="col-span-full text-center py-12 bg-gray-50 rounded-2xl border border-dashed border-gray-200">
                    <p class="text-gray-500">{% trans "Hozircha ma'lumot yo'q." %}</p>
                </div>
                {% endfor %}
            </div>

            <div class="mt-8 text-center md:hidden">
                <a href="{% url 'category_browse' %}" class="btn-outline w-full justify-center">{% trans "Barchasini ko'rish" %}</a>
            </div>
        </div>
    </section>

    <!-- Recent Reviews -->
    <section class="py-10 sm:py-16 bg-[var(--bg)]">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-end mb-12">
                <div>
                    <h2 class="text-3xl font-bold text-[var(--text-primary)] mb-2">{% trans "So'nggi sharhlar" %}</h2>
                    <p class="text-[var(--text-secondary)]">{% trans "Foydalanuvchilarimiz nima deyishmoqda" %}</p>
                </div>
                <a href="{% url 'review_submission' %}" class="hidden md:inline-flex items-center bg-[var(--surface)] border border-[var(--border)] text-[var(--text-secondary)] hover:text-[var(--accent)] font-medium px-5 py-2.5 rounded-xl shadow-sm transition-all">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                    {% trans "Sharh yozish" %}
                </a>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                {% for review in latest_reviews %}
                <div class="bg-[var(--surface)] p-6 rounded-2xl shadow-sm border border-[var(--border)] hover:shadow-md transition-all">
                    <div class="flex items-center mb-4">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-green-100 to-green-200 flex items-center justify-center mr-3 text-green-700 font-bold text-sm">
                            {{ review.user_name|first|default:"U" }}
                        </div>
                        <div>
                            <h4 class="font-semibold text-[var(--text-primary)] text-sm">{{ review.user_name }}</h4>
                            <div class="flex text-yellow-400 text-xs mt-0.5">
                                <span class="font-medium text-[var(--text-secondary)] mr-2">{{ review.rating }}/5</span>
                                {% for i in "12345"|make_list %}
                                    <svg class="w-3 h-3 {% if forloop.counter <= review.rating %}text-yellow-400{% else %}text-[var(--border)]{% endif %}" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    <p class="text-[var(--text-secondary)] text-sm mb-4 line-clamp-3">"{{ review.text }}"</p>
                    <div class="flex items-center justify-between pt-4 border-t border-[var(--border)]">
                        <span class="text-xs font-semibold text-[var(--text-primary)] flex items-center">
                            <svg class="w-3 h-3 mr-1 text-[var(--text-secondary)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                            {{ review.company.name }}
                        </span>
                        <span class="text-xs text-[var(--text-secondary)]">{{ review.created_at|timesince }} {% trans "oldin" %}</span>
                    </div>
                </div>
                {% empty %}
                <div class="col-span-full text-center py-12">
                    <p class="text-gray-500">{% trans "Hozircha sharhlar yo'q." %}</p>
                </div>
                {% endfor %}
            </div>

            <div class="mt-8 text-center md:hidden">
                <a href="{% url 'review_submission' %}" class="btn-primary w-full justify-center">{% trans "Sharh yozish" %}</a>
            </div>
        </div>
    </section>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Fikrly",
      "url": "{{ request.scheme }}://{{ request.get_host }}",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "{{ request.scheme }}://{{ request.get_host }}{% url 'search_businesses' %}?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "ItemList",
      "itemListElement": [
        {
          "@type": "SiteNavigationElement",
          "position": 1,
          "name": "{% trans 'Bosh sahifa' %}",
          "description": "{% trans 'Fikrly bosh sahifasi' %}",
          "url": "{{ request.scheme }}://{{ request.get_host }}{% url 'index' %}"
        },
        {
          "@type": "SiteNavigationElement",
          "position": 2,
          "name": "{% trans 'Kategoriyalar' %}",
          "description": "{% trans 'Barcha kategoriyalar ro\'yxati' %}",
          "url": "{{ request.scheme }}://{{ request.get_host }}{% url 'category_browse' %}"
        },
        {
          "@type": "SiteNavigationElement",
          "position": 3,
          "name": "{% trans 'Bizneslar' %}",
          "description": "{% trans 'Ro\'yxatdan o\'tgan bizneslar' %}",
          "url": "{{ request.scheme }}://{{ request.get_host }}{% url 'business_profile' %}"
        },
        {
          "@type": "SiteNavigationElement",
          "position": 4,
          "name": "{% trans 'Sharh yozish' %}",
          "description": "{% trans 'O\'z fikringizni qoldiring' %}",
          "url": "{{ request.scheme }}://{{ request.get_host }}{% url 'review_submission' %}"
        }
      ]
    }
    </script>
{% endblock %}

{% block extra_js %}
    <script>
        // Enhanced search functionality
        document.addEventListener('DOMContentLoaded', function() {
            const searchForm = document.getElementById('searchForm');
            const searchInput = document.getElementById('searchInput');
            const suggestionsBox = document.getElementById('searchSuggestions');
            let debounceTimer;

            // Focus on search input when page loads
            if(searchInput) {
                searchInput.focus();

                // Handle Enter key press
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        if (searchInput.value.trim()) {
                            searchForm.submit();
                        }
                    }
                });

                // Live Search Logic
                searchInput.addEventListener('input', function() {
                    const query = this.value.trim();

                    clearTimeout(debounceTimer);

                    if (query.length < 2) {
                        suggestionsBox.classList.add('hidden');
                        suggestionsBox.innerHTML = '';
                        return;
                    }

                    debounceTimer = setTimeout(() => {
                        fetch(`{% url 'search_suggestions_api' %}?include_categories=0&q=${encodeURIComponent(query)}`)
                            .then(response => response.json())
                            .then(data => {
                                const companies = (data.results || []).filter(item => item.type === 'company');
                                if (companies.length > 0) {
                                    renderSuggestions(companies);
                                } else {
                                    suggestionsBox.classList.add('hidden');
                                }
                            })
                            .catch(err => console.error('Search error:', err));
                    }, 300);
                });

                // Close suggestions when clicking outside
                document.addEventListener('click', function(e) {
                    if (!searchForm.contains(e.target)) {
                        suggestionsBox.classList.add('hidden');
                    }
                });
            }

            function renderSuggestions(results) {
                let html = '<ul class="divide-y divide-gray-100">';

                results.forEach(item => {
                    const thumb = item.logo || item.image;
                    const imgHtml = thumb
                        ? `<img src="${thumb}" class="w-9 h-9 rounded-md object-cover flex-shrink-0 mr-3" alt="${item.name}" onerror="this.style.display='none'">`
                        : `<div class="w-9 h-9 rounded-md bg-gray-100 flex items-center justify-center flex-shrink-0 mr-3 text-gray-400">
                             <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                           </div>`;

                    html += `
                        <li>
                            <a href="${item.url}" class="flex items-center px-4 py-2.5 hover:bg-gray-50 transition-colors">
                                ${imgHtml}
                                <span class="font-medium text-gray-900 truncate">${item.name}</span>
                            </a>
                        </li>
                    `;
                });

                html += '</ul>';
                suggestionsBox.innerHTML = html;
                suggestionsBox.classList.remove('hidden');
            }

            // Add loading state to search button
            if(searchForm) {
                searchForm.addEventListener('submit', function() {
                    const searchBtnText = document.getElementById('searchBtnText');
                    const searchBtnSpinner = document.getElementById('searchBtnSpinner');
                    const searchBtn = document.getElementById('searchBtn');

                    if (searchBtnText && searchBtnSpinner && searchBtn) {
                        searchBtnText.textContent = '{% trans "Qidirilmoqda..." %}';
                        searchBtnSpinner.classList.remove('hidden');
                        searchBtn.disabled = true;
                    }
                });
            }
        });
    </script>
{% endblock %}
